# Use an official Ubuntu as a parent image
FROM ubuntu:20.04

# Set environment variables to avoid prompts during installation
ENV DEBIAN_FRONTEND=noninteractive

# Install dependencies
RUN apt-get update && \
    apt-get install -y \
    openjdk-17-jdk \
    wget \
    unzip \
    curl \
    git \
    build-essential \
    nodejs \
    npm

# Install pnpm
RUN npm install -g pnpm

# Set JAVA_HOME environment variable
ENV JAVA_HOME=/usr/lib/jvm/java-17-openjdk-amd64

# Install Android SDK
RUN mkdir -p /usr/local/android-sdk && \
    cd /usr/local/android-sdk && \
    wget https://dl.google.com/android/repository/commandlinetools-linux-8512546_latest.zip -O android-sdk.zip && \
    unzip android-sdk.zip && \
    rm android-sdk.zip

ENV ANDROID_HOME=/usr/local/android-sdk
ENV PATH=$PATH:$ANDROID_HOME/cmdline-tools/bin
ENV PATH=$PATH:$ANDROID_HOME/platform-tools

# Accept Android SDK licenses
RUN yes | sdkmanager --licenses

# Copy the project files into the Docker image
WORKDIR /app
COPY . .

# Install project dependencies
RUN ./scripts/install-dependencies.sh

# Make scripts executable
RUN chmod +x ./scripts/helpers/*.sh

# Set the entry point to the dev script
ENTRYPOINT ["./scripts/start-android.sh"]
